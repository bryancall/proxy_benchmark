# HAProxy configuration for benchmarking
# Replace {{ORIGIN_HOST}}, {{ORIGIN_PORT}}, {{CERT_DIR}} with actual values
#
# NOTE: HAProxy does not have built-in HTTP caching like ATS, Nginx, or Envoy.
# The "cached" scenarios will effectively be pass-through (same as uncached).
# This is a fair comparison of raw proxy performance without caching benefits.

global
    log stdout format raw local0
    maxconn 30000
    nbthread 1
    # Tune for performance
    tune.ssl.default-dh-param 2048

defaults
    log     global
    mode    http
    option  httplog
    option  dontlognull
    option  http-keep-alive
    timeout connect 5s
    timeout client  30s
    timeout server  30s
    timeout http-keep-alive 60s
    # Disable logging for benchmarking
    no log

# HTTP frontend (port 8083)
frontend http_front
    bind *:8083
    default_backend origin_backend

# HTTPS frontend (port 8446)
frontend https_front
    bind *:8446 ssl crt {{CERT_DIR}}/server.pem alpn h2,http/1.1
    default_backend origin_backend

# Origin backend
backend origin_backend
    balance roundrobin
    option http-keep-alive
    http-reuse always
    server origin {{ORIGIN_HOST}}:{{ORIGIN_PORT}} check

# Stats endpoint (optional, for debugging)
frontend stats
    bind *:8484
    mode http
    stats enable
    stats uri /stats
    stats refresh 10s

